===
.HAA. Advanced: Tags are dynamic
===
{character}: Hello there! #{character}_greeting.jpg 

I open the door. #suspense_music{RANDOM(1, 4)}.mp3 
---

(ink
  (paragraph
    (eval
      (identifier))
    (text
      (word)
      (word)
      (word)
      (word))
    (tag
      (eval
        (identifier))
      (text
        (word)
        (word)
        (word))))
  (paragraph
    (text
      (word)
      (word)
      (word)
      (word)
      (word))
    (tag
      (text
        (word))
      (eval
        (call
          (identifier)
          (args
            (number)
            (number))))
      (text
        (word)
        (word)))))

===
.HAB. Dynamic tags can contain inline logic (conditional text, alternatives, ...)
===
I push the door. # door_{door ? locked:thump|creak}.mp3 # suspense_music_{~1|2|3}.mp3
---

(ink
  (paragraph
    (text
      (word)
      (word)
      (word)
      (word)
      (word))
    (tag
      (text
        (word))
      (conditional_text
        (binary
          (identifier)
          (identifier))
        (content
          (text
            (word)))
        (content
          (text
            (word))))
      (text
        (word)
        (word)))
    (tag
      (text
        (word))
      (alternatives
        (content
          (text
            (word)))
        (content
          (text
            (word)))
        (content
          (text
            (word))))
      (text
        (word)
        (word)))))

===
.HAC. Dynamic tags can contain multiline logic (conditional text, alternatives, ...)
===
// actually it can't but it's just simpler to parse _one_ set of rules.
I push the door. # door_{door ? locked:
        <>thump<>
- else: <>creak<>
}.mp3 # suspense_music_{shuffle:
- 1
- 2
- 3
}.mp3
---

(ink
  (line_comment)
  (paragraph
    (text
      (word)
      (word)
      (word)
      (word)
      (word))
    (tag
      (text
        (word))
      (cond_block
        (cond_arm
          (binary
            (identifier)
            (identifier))
          (eol)
          (paragraph
            (glue)
            (text
              (word))
            (glue)))
        (cond_arm
          (else)
          (paragraph
            (glue)
            (text
              (word))
            (glue))))
      (text
        (word)
        (word)))
    (tag
      (text
        (word))
      (multiline_alternatives
        (alt_arm
          (paragraph
            (text
              (word))))
        (alt_arm
          (paragraph
            (text
              (word))))
        (alt_arm
          (paragraph
            (text
              (word)))))
      (text
        (word)
        (word)))))
